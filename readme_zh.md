# 日历事件时长标记脚本

## 功能概述

这个AppleScript脚本自动为日历中的事件添加持续时间标记。它会遍历您的个人日历，检测当天没有时间标记的事件，然后将事件的持续时间添加到事件标题的末尾。

例如：
- "项目讨论" → "项目讨论 60min"
- "团队会议" → "团队会议 1.5h"

## 特性

- 自动检测并只处理个人可写入的日历
- 智能时间格式：短事件显示为分钟(min)，长事件显示为小时(h)
- 自动跳过已经包含时间信息的事件
- 可配置的日志记录，方便调试问题
- 运行结束后显示处理统计信息

## 配置选项

脚本顶部有几个可以根据需要调整的配置选项：

```applescript
-- 配置选项
set enableDetailedLogging to false -- 是否启用详细日志（修改为true开启详细日志）
set timeFormat to "auto" -- 时间格式："minutes"(分钟)、"hours"(小时)或"auto"(自动判断)
set hourThreshold to 300 -- 分钟阈值，超过此值时使用小时单位（当timeFormat为"auto"时生效）
```

### 配置详解

1. **enableDetailedLogging**
   - `true`: 启用详细日志记录，日志将保存到桌面上的文件中
   - `false`: 禁用详细日志记录（默认）

2. **timeFormat**
   - `"minutes"`: 始终使用分钟作为时间单位（例如：90min）
   - `"hours"`: 始终使用小时作为时间单位（例如：1.5h）
   - `"auto"`: 根据事件持续时间自动选择合适的单位（默认）

3. **hourThreshold**
   - 当`timeFormat`设置为`"auto"`时，超过此分钟阈值的事件将使用小时单位
   - 默认值为300（5小时）

## 使用方法

1. 打开"脚本编辑器"应用程序（在"应用程序/实用工具"文件夹中）
2. 复制并粘贴脚本内容
3. 根据需要调整配置选项
4. 点击"运行"按钮执行脚本
5. 脚本执行完成后，将显示处理结果统计信息

## 工作原理

脚本执行以下步骤：

1. **日历识别**：
   - 检查所有可访问的日历
   - 根据可写入性和其他特性识别个人日历
   - 排除系统预设日历如"生日"、"节假日"等

2. **事件处理**：
   - 只处理当天（从午夜到次日午夜）的事件
   - 计算每个事件的持续时间（分钟）
   - 检查事件标题是否已含有时间信息
   - 对于需要处理的事件，格式化时间并添加到标题末尾

3. **时间格式化**：
   - 短事件显示为分钟数（例如：45min）
   - 长事件转换为小时并保留一位小数（例如：2.5h）
   - 整小时显示为x.0h格式（例如：2.0h）

## 故障排除

如果脚本未按预期工作：

1. 将`enableDetailedLogging`设置为`true`
2. 再次运行脚本
3. 查看桌面上生成的`calendar_script_log.txt`文件，了解详细执行过程和错误信息

## 安全注意事项

- 脚本只修改事件标题，不会删除事件或更改时间信息
- 只处理可写入的个人日历，不会修改共享或订阅的日历
- 已包含时间信息的事件将被自动跳过，避免重复添加时间标记

## 定期运行

您可以：
- 将此脚本保存为应用程序，并添加到"登录项"以在每次登录时运行
- 使用"自动操作"或"日历"应用程序创建定期运行此脚本的自动化
- 手动在需要时运行脚本，将当天的事件标记上时间信息

---

希望这个脚本能帮助您更好地管理和查看日历事件的时间安排！如有问题或需要更多功能，可以进一步修改脚本。